<!DOCTYPE html>
<html lang="en">

<head>

  <meta charset="UTF-8">
  <meta name="description" content=" David Kozdra is a Software Developer specializing in the MERN stack ">
  <meta name="keywords" content="Computer Science ">
  <meta name="author" content="David Kozdra">
  <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1">

  <title>David Kozdra</title>

  <link rel="stylesheet" id="modern" href="styles/DEstyles.css?v=1.14" >
  <link rel="stylesheet" id="retro" href="styles/retro.css?v=1.2" disabled="true">


  <link class="import" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="icon" type="image/x-icon" href="/images/favicon.ico">


  <script src="Games.js?v=1.0"></script>

  <style>
    .empty_window {
      display: none !important;

    }
  </style>
</head>

<body>
  <div class="loader-page">
    <div class="loader-display">
      <img class="loader-icon" src="./images/favicon.ico" alt="DK logo white and blue gradient background"></img>

      <p class="typewriter">
        Loading DK OS ...
      </p>

      <div class="loader-back">
        <div class="loader-icon-inner"></div>
      </div>
    </div>

  </div>
  <div id="de">
    <div class="task-bar">
      <!-- Navigation Menu -->

      <div class="navigation">
        <div class="drop-down" style="padding-left: 10%; padding-right: 10%;">
          <button style="padding: 0%;"><img src="images/favicon.ico" alt="david kozdra icon"
              id="task-bar-icon"></button>
          <div class="drop-down-content">
            <button id="settingsButton" onclick="desktopIconRouter(event,'System')"> System</button>
            
            <button onclick="desktopIconRouter(event,'term')"> Terminal</button>
            <button onclick="desktopIconRouter(event,'calculator')"> Calculator</button>

            <button onclick="desktopIconRouter(event,'notes')"> Notes</button>
            <button onclick="refresh()"> <i class="fa fa-power-off"> </i> </button>
          </div>
        </div>
        <div class="drop-down">
          <button onclick="desktopIconRouter(event,'about')"> About Me </button>
        </div>
        <div class="drop-down">
          <button style="cursor: unset;"> Projects </button>
          <div class="drop-down-content">
            <button onclick="desktopIconRouter(event,'old')"> My Website</button>
            <button> <a href="https://virtualnerd1.itch.io/cloudy-meadows" target="_blank" style="color: whitesmoke;">
                Cloudy Meadows </a></button>
          </div>
        </div>
        <div>
          <button onclick="desktopIconRouter(event,'resume')" > Resume</button>
  </div>
      </div>

      <div class="status-bar">
        <div id="clock"> </div>


        <div id="Contact">
          
          <a aria-label="David Kozdra's EMAIL" href="mailto://davidkozdra@gmail.com"  target="_blank"> <i
            class="fa fa-envelope fa-1x"></i></a>
          <a aria-label="David Kozdra's Github" href="https://github.com/DavidKozdra" target="_blank"> <i
              class="fa-brands fa-github fa-1x">
            </i></a>

          <a aria-label="David Kozdra's linkedin" href="https://www.linkedin.com/in/david-kozdra-5ab269186/"
            target="_blank"> <i class="fa-brands fa-linkedin fa-1x"> </i></a>

          <a aria-label="David Kozdra's itch.io" href="https://magentaautumn.itch.io"  target="_blank"> <i
              class="fa-brands fa-itch-io fa-1x" ></i></a>


        </div>

        <div> <i class="fas fa-wifi"></i> </div>
      </div>
    </div>

    <div id="desktop" ondrag="drawSelectionRect()">
      <div id="windows">

      </div>

      <div class="desktop-grid">

        <div class="desktop-icon" onclick="selectIcon(event)" ondblclick="desktopIconRouter(event,'term')"  
          o tabindex="0">
          <img src="./images/Term.png" alt="desktop icon of a computer terminal black and lime green"></img>
          <p contenteditable="true" class="icon-text"> Terminal</p>
        </div>
        <div class="desktop-icon" onclick="selectIcon(event)" ondblclick="desktopIconRouter(event,'dragon_game')"  
        o tabindex="0">
        <img src="./images/dragon_fighter.png" alt="desktop icon of a computer terminal black and lime green"></img>
        <p contenteditable="true" class="icon-text"> dragon fighter balls</p>
      </div>
        <div class="desktop-icon" onclick="selectIcon(event)" ondblclick="desktopIconRouter(event,'draw')" 
           tabindex="0">
          <img src="./images/Pallet.png" alt="Art Pallet drawing in pixel art"></img>
          <p contenteditable="true" class="icon-text"> Draw</p>
        </div>

        <div class="desktop-icon" onclick="selectIcon(event)" ondblclick="desktopIconRouter(event,'GOL')" tabindex="0"> 
          <img src="./images/GOL.png" alt="Game of Life Grid of green and grey squares"></img>
          <div class="icon-text">
            <p contenteditable="true">Game Of Life</p>
          </div>
        </div>


        <div class="desktop-icon" onclick="selectIcon(event)" ondblclick="desktopIconRouter(event,'calculator')"
          tabindex="0">
          <img src="./images/Calc.png" alt="calculator icon"></img>
          <div class="icon-text">
            <p contenteditable="true">Calculator</p>
          </div>
        </div>


        <div class="desktop-icon" onclick="selectIcon(event)" ondblclick="desktopIconRouter(event,'notes')" tabindex="0"
          style="cursor: pointer;">
          <img src="./images/Notes.png" alt="yellow note pad "></img>
          <div class="icon-text">
            <p contenteditable="true">Notes</p>
          </div>
        </div>
      </div>
    </div>

    <div class="app-bar"> Tasks <div class="btn-group"> </div>
    <div class="app-bar-buffer">buffer</div>
    </div>
  </div>


  <script>

    var fileSystem;

document.addEventListener('DOMContentLoaded', () => {

 fileSystem = (localStorage.getItem("fileSystem") == null ) ? [{dir:"/" , files:[{name:"text.txt", content:"testing lol", dir:false}, {name:"home", dir:true}]}, {dir:"home" , files:[{name:"text2.txt", content:"file 2 write waht you want and it will save "}]} ] : JSON.parse(localStorage.getItem("fileSystem"));
        
  window.addEventListener('message', (event) => {
    receiveMessage(event)
  }, false);

  desktopIconRouter(null, "System");

  desktopIconRouter(null, "empty");


  // render the file system if it has content
  // it should act as a notes icon with the file name as the name
  // and the content as the content
  
  for(let i = 0; i < fileSystem.length; i++){
    for(let j = 0; j < fileSystem[i].files.length; j++){
      if (fileSystem[i].files[j].dir) {
        continue;
      }
      let file = fileSystem[i].files[j];
      let icon = document.createElement("div");
      icon.classList.add("desktop-icon");
      icon.onclick = function(){
        selectIcon(event);
      };
      icon.ondblclick = function(){
        desktopIconRouter(event, "notes",  file.name , {content: file.content, parent: fileSystem[i].dir});
      };
      let img = document.createElement("img");
      img.src = "./images/Notes.png";
      let text = document.createElement("div");
      text.classList.add("icon-text");
      text.contentEditable = "true";
      text.innerHTML = file.name;
      icon.appendChild(img);
      icon.appendChild(text);

      //init drag
      dragElement(icon, icon);

      //add to the grid
      document.getElementsByClassName("desktop-grid")[0].appendChild(icon);
    }
  }
});

    let desktopIcons = document.getElementsByClassName("desktop-icon");


    let windows = document.getElementsByClassName("window");
    let winLen = 0;
    let activeWindowCount = 0;
    let loading = true;

    
    const adjustBoundaries = () => {
      const headerElement = document.getElementsByClassName('task-bar')[0];
      const appbarElement = document.getElementsByClassName('app-bar')[0];

      // Set your desired boundary left position
      const boundaryLeft = 10;

      // Get the height of the header and app bar
      const boundaryTop = headerElement ? headerElement.offsetHeight : 0;
      const maxBottom = appbarElement ? window.innerHeight - appbarElement.offsetHeight : window.innerHeight;

      return { boundaryTop, maxBottom, boundaryLeft };
    };

    const applyBoundaries = (array) => {
      const { boundaryTop, maxBottom, boundaryLeft } = adjustBoundaries();

      for (let i = 0; i < array.length; i++) {
        const rect = array[i].getBoundingClientRect();

        // check for collison with the appbar
        if (isColliding(array[i], document.getElementsByClassName('app-bar')[0])) {
          //array[i].style.top = maxBottom - array[i].offsetHeight + 'px';
          if (array[i].classList.contains("desktop-icon")) {
            array[i].style.top = maxBottom - window.innerHeight / 10 + 'px';
          } else {
            array[i].style.top = maxBottom - array[i].offsetHeight + 'px';
          }


        }

        if (rect.top < boundaryTop) {
          array[i].style.top = boundaryTop + 'px';
        }

        if (rect.left < boundaryLeft) {
          array[i].style.left = boundaryLeft + 'px';
        }

      }
    };

    let activeWindows = document.getElementsByClassName("window");

    let maxZindex = 1;
    async function update() {
      if (loading) {
        document.getElementsByClassName("loader-page")[0].style.display = "block";
        document.getElementById("de").style.display = "none";
        await delay(1200);
        document.getElementsByClassName("loader-page")[0].style.display = "none";
        document.getElementById("de").style.display = "block";
        loading = false;
      } else {

        //loop for all desktop icons
        for (let i = 0; i < desktopIcons.length; i++) {
          for (let j = 0; j < desktopIcons.length; j++) {
            if (i != j) {
              checkCollision(desktopIcons[i], desktopIcons[j]);
            }
          }
          if (desktopIcons[i].offsetWidth > desktop.offsetWidth) {
            desktopIcons[i].style.width = desktop.offsetWidth + "px";
          }
          if (desktopIcons[i].offsetHeight > desktop.offsetHeight) {
            desktopIcons[i].style.height = desktop.offsetHeight + "px";
          }
          //applyBoundaries(desktopIcons);
        }

        activeWindows = document.getElementsByClassName("window");
        activeWindows = Array.from(activeWindows).filter(window => !window.classList.contains("minimized"));

        activeWindows.map(window => {


          // if the window is larger than the desktop area then set the dimentions to the desktop area
          if (window.offsetWidth > desktop.offsetWidth) {
            window.style.width = desktop.offsetWidth -5 + "px";
          }
          if (window.offsetHeight > desktop.offsetHeight) {
            window.style.height = desktop.offsetHeight -5  + "px";
          }

          //calculate the max z index
          if (window.style.zIndex > maxZindex) {
            maxZindex = window.style.zIndex;
          }

          window.childNodes[0].style.width = window.offsetWidth + "px";
        });

        if(activeWindowCount > 0){
          //get desktop and set the height to 92 dvh
          let desktop = document.getElementById("desktop");
          desktop.style.height = "92dvh";
        }else {
          //get desktop and set the height to 100 dvh
          let desktop = document.getElementById("desktop");
          desktop.style.height = "93.5dvh";
        }

        applyBoundaries(activeWindows);
        if (activeWindowCount != activeWindows.length) {
          ReRenderAppTaskbar();
          activeWindowCount = activeWindows.length;
        } else if (windows.length != winLen) {
          ReRenderAppTaskbar();
          winLen = windows.length;
        }
      }

      requestAnimationFrame(update);
    }

    function resizeWindowTItle(de_window) {
      let title = de_window.querySelector(".window-title");
      title.style.width = de_window.offsetWidth + "px";

    }

    function ReRenderAppTaskbar() {

      let taskbar = document.getElementsByClassName("app-bar");
      taskbar[0].innerHTML = "Tasks ";

      for (let i = 0; i < windows.length; i++) {
        if(windows[i].classList.contains("empty_window")){
          continue;
        }
        let taskbarButton = document.createElement("button");
        let taskbarButtonIcon = document.createElement("img");
        taskbarButtonIcon.alt = "window icon for " + windows[i].id ;
        taskbarButtonIcon.classList.add("window-icon");
        taskbarButtonIcon.src = windows[i].childNodes[0].childNodes[0].src;
        taskbarButton.classList.add("app-bar-button");
        if (windows[i].classList.contains("minimized")) {
          taskbarButton.classList.remove("app-bar-button-active");
        } else {
          taskbarButton.classList.add("app-bar-button-active");
        }
        taskbarButton.onclick = function () {
          if (windows[i].classList.contains("minimized")) {
            windows[i].classList.remove("minimized");
            setFocusedWindow(windows[i]);
          } else {
            windows[i].classList.add("minimized");
       
          }
        };
        taskbarButton.appendChild(taskbarButtonIcon);

        taskbarButton.innerHTML += windows[i].id;
        taskbar[0].appendChild(taskbarButton);
      }
    }

    function drawSelectionRect() {
      //take the mouse pos and draw a rect from the start to the current pos
      let rect = document.createElement("div");
      rect.classList.add("selection-rect");
      document.getElementById("desktop").appendChild(rect);
    }


    function CreateDesktopIconGrid() {
      const iconSize = 100; // Adjust this based on the desired icon size
      const margin = 10; // Adjust this based on the desired margin between icons

      // Calculate the number of icons per row dynamically
      const iconsPerRow = Math.floor((window.innerWidth - margin) / (iconSize + margin));
      // y mod should grow with the window width
      let ymod = -120 * (window.innerWidth / 5000);
      let xmod = 0;

      for (let i = 0; i < desktopIcons.length; i++) {
        if (i % iconsPerRow === 0) {
          ymod += iconSize + margin;
          xmod = 0;
        }
        // Set the position of the icon based on the index
        desktopIcons[i].style.left = xmod * (iconSize + margin) + "px";
        desktopIcons[i].style.top = ymod + "px";

        xmod += 1;
      }
    }

    function checkCollision(item1, item2) {
      const rect1 = item1.getBoundingClientRect();
      const rect2 = item2.getBoundingClientRect();

      if (
        rect1.left < rect2.right &&
        rect1.right > rect2.left &&
        rect1.top < rect2.bottom &&
        rect1.bottom > rect2.top
      ) {
        // Calculate the overlap in both the x and y directions
        const overlapX = Math.min(rect1.right - rect2.left, rect2.right - rect1.left);
        const overlapY = Math.min(rect1.bottom - rect2.top, rect2.bottom - rect1.top);

        // Adjust the positions to resolve the collision
        item1.style.left = (parseFloat(item1.style.left) || 0) + overlapX + 'px';
        item1.style.top = (parseFloat(item1.style.top) || 0) + overlapY + 'px';

      }
    }


    function isColliding(item1, item2) {
      const rect1 = item1.getBoundingClientRect();
      const rect2 = item2.getBoundingClientRect();

      if (
        rect1.left < rect2.right &&
        rect1.right > rect2.left &&
        rect1.top < rect2.bottom &&
        rect1.bottom > rect2.top
      ) {
        return true;
      } else {
        return false;
      }
    }


    CreateDesktopIconGrid();


    // has to do it this way no event
    //desktopIconRouter(document.getElementById("settingsButton").event, "System");


    function DisplayDate() {
      var date = new Date();
      var hours = date.getHours();
      var minutes = date.getMinutes();
      var seconds = date.getSeconds();
      var ampm = "AM";
      if (hours > 12) {
        hours = hours - 12;
        ampm = "PM";
      }
      if (hours == 0) {
        hours = 12;
      }
      if (minutes < 10) {
        minutes = "0" + minutes;
      }
      if (seconds < 10) {
        seconds = "0" + seconds;
      }
      var time = hours + ":" + minutes + ":" + seconds + " " + ampm;
      document.getElementById("clock").innerHTML = time;
    }

    setInterval(DisplayDate, 500);


    function closeWindow(e, name) {
      // close the parent window from the event target
      let closest_window = e.target.closest(".window");
      closest_window.remove();
    }

    function minimizeWindow(e, name) {
      let closest_window = e.target.closest(".window ");
      closest_window.classList.toggle("minimized");
    }

    function maximizeWindow(e, name) {
      let currentWindow = e.target.closest(".window");

      if (currentWindow !== null) {
        currentWindow.classList.toggle("larger");

        // Check if there's an existing child before removing it
        if (e.target.childNodes[0] !== undefined) {
          e.target.childNodes[0].remove();
        }

        let windowbuttons = currentWindow.querySelector(".window-buttons");
        windowbuttons.childNodes[1].innerHTML = "";
        // Create a new icon element
        let icon = document.createElement('i');
        icon.classList.add('fas');

        // Determine the icon class based on the "larger" class
        if (currentWindow.classList.contains("larger")) {
          icon.classList.add('fa-compress');
        } else {
          icon.classList.add('fa-expand');
        }


        // Append the icon to the target element
        windowbuttons.childNodes[1].appendChild(icon);


        resizeWindowTItle(currentWindow);
      }
    }




    //function to check if the window button has both fa-expand and fa-compress
    function checkWindowButton(e) {
      if (e.target.classList.contains("fa-expand") && e.target.classList.contains("fa-compress")) {
        return true;
      } else {
        return false;
      }
    }


    function dragElement(title, elmnt) {
      var pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;
      if (title == null) {
        return;
      }

      // If present, the header is where you move the DIV from:
      title.onmousedown = dragMouseDown;

      function dragMouseDown(e) {
        e = e || window.event;
        e.preventDefault();

        // Get the mouse cursor position at startup:
        pos3 = e.clientX;
        pos4 = e.clientY;
        document.onmouseup = closeDragElement;
        document.onpointerup = closeDragElement;
        document.ontouchend = closeDragElement;
        // Call a function whenever the cursor moves:
        document.onpointermove = elementDrag;
        document.onmousemove = elementDrag;
        //document.onmouseleave = closeDragElement;
      }

      function elementDrag(e) {
        e = e || window.event;
        e.preventDefault();
        // Calculate the new cursor position:
        pos1 = pos3 - e.clientX;
        pos2 = pos4 - e.clientY;
        pos3 = e.clientX;
        pos4 = e.clientY;

        // Check boundaries
        const newTop = Math.max(0, Math.min(elmnt.offsetTop - pos2, window.innerHeight - elmnt.offsetHeight));
        const newLeft = Math.max(0, Math.min(elmnt.offsetLeft - pos1, window.innerWidth - elmnt.offsetWidth));

        // Set the element's new position:
        elmnt.style.top = newTop + "px";
        elmnt.style.left = newLeft + "px";
      }


    }
    function closeDragElement() {
      // Stop moving when the mouse button is released:
      document.onmouseup = null;
      document.onpointerup = null;
      document.onmousemove = null;
      document.ontouchend = null;

      // this one fixes the weird bug where the mouse is still in the window and it moves
      document.onpointermove = null;
    }
    function setCursor() {
      //conditionally set the cursor to wait globally
      document.body.style.cursor = "wait";
    }

    function deselectAllIcons() {
      let desktopIcons = document.getElementsByClassName("desktop-icon");
      for (let i = 0; i < desktopIcons.length; i++) {
        desktopIcons[i].classList.remove("active");
      }
    }

    function selectIcon(e) {
      if (!e.target.classList.contains("icon-text")) {
        e.target.classList.toggle("active");
      }


      e.target.classList.toggle("active");
    }
    function delay(ms) {
      return new Promise(resolve => setTimeout(resolve, ms));
    }

    async function desktopIconRouter(e, newWindowHeaderTitle, newTitle=undefined,data=undefined) {
      // Set the cursor to the waiting state
      if(e != null){
        setCursor(e);
      }

      // Wait for the specified delay
      await delay((Math.random() * 1000) + 200);

      // Now the delay is complete, proceed to open the window
      switch (newWindowHeaderTitle) {
        case "test":
          createWindow("Test", "This is a test window", "./images/blocks.jpg", false);
          break;
          case "empty": 
          createWindow("empty", null, "./images/Term.png", 800);
          break;
        case "term": 
          let term = document.createElement("iframe");
          term.name = "terminal";
          term.title = "terminal";
          term.style.marginTop = "50px";
          term.src = "./CMD.html";
          term.style.height = "100%";
          term.style.width = "100%";
          createWindow("Terminal", term, "./images/Term.png", 800);
          break;
        case "resume":
          let resume = document.createElement("iframe");
          resume.name = "resume";
          resume.title = "resume";
          resume.src = "./resume.html";
          resume.style.height = "90%";
          resume.style.marginTop = "50px";
          resume.style.width = "100%";
          resume.frameborder = "0";

          createWindow("Resume", resume, "./images/Resume.png", 800);


          break;

        case "System":
          let intro = document.createElement("iframe");
          intro.name = "Intro Panel";
          intro.title = "Intro Panel";
          intro.src = "./intro.html";
          intro.style.height = "100%";
          intro.style.width = "100%";
          createWindow("System", intro, "./images/favicon.ico", 850, true);
          break;


        case "calculator":
          let calculator = document.createElement("iframe");
          calculator.name = "calculator";
          calculator.title = "calculator";
          calculator.src = "./calculator.html";
          calculator.style.height = "100%";
          calculator.style.width = "100%";
          createWindow("Calculator", calculator, "./images/Calc.png", 400, false);
          break;
        case "dragon_game":
          let game = document.createElement("iframe");
          game.name = "dragon_game";
          game.title = "dragon_game";
          game.src = "https://main.d3722xrzul5kke.amplifyapp.com/";
          game.style.height = "100%";
          game.style.width = "100%";
          createWindow("Dragon Fighters Balls", game, "./images//dragon_fighter.png", 800, false);
          break;

        case "notes":
          let notes = document.createElement("div");
       
          notes.classList.add("notes");
          notes.name = "note pad";
          notes.title = "note pad";
          let textArea = document.createElement("textarea");
          textArea.classList.add("notes-textarea");
          textArea.rows = "25";
          textArea.cols = "45";
          textArea.placeholder = "Enter your notes here";
          if (data) {
            console.log(data);
            textArea.textContent = data.content;
            console.log(textArea.value);
          }
          // local storage for notes get and set on change of value 
          textArea.onchange = function () {
            
            //find this file and update the content
            for (let i = 0; i < fileSystem.length; i++) {
                if (fileSystem[i].dir == data.parent) {
                    for (let j = 0; j < fileSystem[i].files.length; j++) {
                        if (fileSystem[i].files[j].name == newTitle) {
                            fileSystem[i].files[j].content = textArea.value;
                        }
                    }
                }
            }
            //save in local storage
            
            localStorage.setItem("fileSystem", JSON.stringify(fileSystem));
          };
          notes.appendChild(textArea);
          createWindow( newTitle ? newTitle : "Notes" , notes, "./images/Notes.png", 500);
          break;


        case "about":
          let about = document.createElement("iframe");
          about.name = "about David Kozdra";
          about.title = "about David Kozdra";
          about.src = "./about.html";
          about.style.height = "100%";
          about.style.width = "100%";
          createWindow("About", about, "./images/ME.jpg", 800);
          break;

        case "old":
          let iframe = document.createElement("iframe");
          iframe.name = "old website";
          iframe.title = "old website";
          iframe.src = "./index copy.html";
          iframe.style.height = "700px";
          iframe.style.width = "100%";
          createWindow("Old Website", iframe, "./images/favicon.ico", 800);
          break;


        case "error":
          createWindow("Error", "This is a test window", "./images/drawIcon.png", 200);

        case "draw":
          let draw = document.createElement("iframe");
          draw.name = "drawing";
          draw.title = "drawing";
          draw.src = "./drawing.html";
          draw.style.height = "100%";
          draw.style.width = "100%";
          draw.style.marginTop = "50px";
          createWindow("Drawing", draw, "./images/Pallet.png", 800, false);
          break;

        case "GOL":
          let GOLcontainer = document.createElement("iframe");
          GOLcontainer.name = "Game of Life";
          GOLcontainer.title = "Game of Life";
          GOLcontainer.src = "./GOL.html";
          GOLcontainer.style.height = "100%";
          GOLcontainer.style.width = "100%";

          createWindow("Game of Life", GOLcontainer, "./images/GOL.png", 500, false);
          currentSlide = -1;
          init()
          break;
        default:
          console.error("Window not found");
          break;
      }

      // Reset the cursor to the default state
      document.body.style.cursor = "default";
      if(e){
        e.target.style.cursor = "default";
      }


    }

    function setCursor(e) {
      // Your cursor-setting logic here
      document.body.style.cursor = "wait";
      // set important cursor styles

      e.target.style.cursor = "wait";
    }
    function createWindow(title, content, iconSrc, width, canResize = true) {


      const id = title.toLowerCase().replace(/\s+/g, '-'); // Generate id based on the title
      const newWindow = document.createElement("div");
      newWindow.classList.add("window");
      newWindow.id = id;


      const headerImage = createWindowHeaderImage(iconSrc);
      const header = createWindowHeader(title, id);
      const buttons = createWindowButtons(id, canResize);

      header.appendChild(headerImage);
      header.innerHTML += title;
      header.appendChild(buttons);
      newWindow.style.width = width + "px";
      newWindow.marginTop = "50px";
      newWindow.appendChild(header);

      // Check if the content is a node 
      if (!(content instanceof Node)) {
        const windowContent = createWindowContent(content);
        newWindow.appendChild(windowContent);
      } else {
        newWindow.appendChild(content);
      }

      newWindow.onmousedown = function () {
        setFocusedWindow(newWindow);
      };

      newWindow.onmouseleave = function () {
        //!! set the drag element to null
        closeDragElement();
        document.onpointermove = null;
      };
      newWindow.onmouseup = function () {
        closeDragElement();
        
        //!! set the drag element to null should work but doesnt
        //document.onpointermove = null;
      };


      if (title == "empty") {
        newWindow.classList.add("empty_window");
      }
      newWindow.style.display = "block";
      document.getElementById("windows").appendChild(newWindow);

      // Set the window position
      //newWindow.style.top = y + "px";
      //newWindow.style.left = x + "px";


      resizeWindowTItle(newWindow);
      // Initialize drag behavior
      dragElement(header, newWindow);
      setFocusedWindow(newWindow)


      return newWindow;
    }

    function setFocusedWindow(newWindow){
      if (newWindow.style.zIndex !== maxZindex) {
          maxZindex += 1;
          newWindow.style.zIndex = maxZindex;
        } else {
          // If the z-index is already the maximum, do nothing
          console.error("Already at maximum z-index:", newWindow.style.zIndex);
        }
    }

    function createWindowHeaderImage(src) {
      const headerImage = document.createElement("img");
      headerImage.classList.add("window-icon");
      headerImage.src = src;
      return headerImage;
    }

    function createWindowHeader(title, id) {
      const header = document.createElement("div");
      header.classList.add("window-title");
      return header;
    }

    function createWindowButtons(id, canResize = true) {
      const buttons = document.createElement("div");
      buttons.classList.add("window-buttons");
      let minIcon = document.createElement("i");
      minIcon.classList.add("fas");
      minIcon.classList.add("fa-chevron-down");
      minIcon.name = "minimize";

      const buttonMin = createWindowButton(minIcon, function () {
        minimizeWindow(event, id);
      });
      let buttonMax;
      if (canResize) {
        let maxIcon = document.createElement("i");
        maxIcon.classList.add("fas");
        maxIcon.classList.add("fa-expand");

        buttonMax = createWindowButton(maxIcon, function () {
          maximizeWindow(event, id);
        });
      }

      let closeIcon = document.createElement("i");
      closeIcon.classList.add("fas");
      closeIcon.classList.add("fa-times");
      closeIcon.name = "close";


      const buttonClose = createWindowButton(closeIcon, function () {
        closeWindow(event, id);
      });


      buttonMin.style.color = "black";
      buttonClose.style.color = "black";

      buttons.appendChild(buttonMin);
      if (canResize == true) {
        buttonMax.style.color = "black";
        buttons.appendChild(buttonMax);
      }
      buttons.appendChild(buttonClose);

      return buttons;
    }

    function createWindowButton(text, clickHandler) {
      const button = document.createElement("button");
      button.classList.add("window-button");
      button.name = text.innerHTML + " button";
      button.appendChild(text);
      button.addEventListener('click', clickHandler);
      return button;
    }

    function createWindowContent(content) {
      const contentElement = document.createElement("div");
      contentElement.classList.add("window-content");

      const contentText = document.createElement("p");
      contentText.innerHTML = content;

      // Modify this part to add your specific content, e.g., iframe
      contentElement.appendChild(contentText);
      return contentElement;
    }

    // Initialize drag for desktop icons
    for (let i = 0; i < desktopIcons.length; i++) {
      dragElement(desktopIcons[i], desktopIcons[i]);
      desktopIcons[i].onmouseup = function () {
        
        document.onpointermove = null;
        closeDragElement();
      };
      
    }

    function moveElement(event, element) {
      if (element == null) {
        return;
      }

      const draggedElement = element;

      //element.style.cursor = "grabbing";

      // Check if the mouse is pressed
      if (event.buttons !== 1) return;

      // Calculate the new position of the dragged element
      const newX = event.clientX - draggedElement.offsetWidth / 2;
      const newY = event.clientY - draggedElement.offsetHeight / 2;

      // Set the new position
      draggedElement.style.left = newX + 'px';
      draggedElement.style.top = newY + 'px';
    }

    requestAnimationFrame(update);


    function refresh() {
      location.reload();
    }

    window.addEventListener('resize', function () {
      for (let i = 0; i < activeWindows.length; i++) {
        resizeWindowTItle(activeWindows[i]);
        applyBoundaries(activeWindows);

      }
      CreateDesktopIconGrid();
    });

    // Function to handle messages from the iframe
    function receiveMessage(event) {
      if(!event){
        return;
      }
      if (event.data && event.data.stylesheetId) {
        // Disable all parent stylesheets

        const parentStylesheets = document.querySelectorAll('link[rel="stylesheet"]:not(.import)');
        parentStylesheets.forEach(sheet => sheet.disabled = true);
        localStorage.setItem('defaultStyleSheet', event.data.stylesheetId);
        // Enable the selected stylesheet in the parent document
        document.getElementById(event.data.stylesheetId).disabled = false;

      }
    }

  </script>


</body>

</html>