<!DOCTYPE html>
<html lang="en">

<head>

  <meta charset="UTF-8">
  <meta name="description" content="David Kozdra is a full-stack software developer specializing in web applications using MongoDB, Express.js, React.js, and Node.js (MERN stack).">
<meta name="keywords" content="software developer, web developer, full-stack developer, MERN stack, MongoDB, Express.js, React.js, Node.js, JavaScript, web applications">


<meta property="og:title" content="David Kozdra - Software Developer Specializing in MERN Stack">
<meta property="og:description" content="Full-stack software developer specializing in web applications using MongoDB, Express.js, React.js, and Node.js.">
<meta property="og:image" content="https://davidkozdra.com/images/favicon.webp">
<meta property="og:url" content="https://davidkozdra.com">
<meta property="og:type" content="website">

  <meta name="author" content="David Kozdra">
  <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1">
  <meta name="theme-color" content="#1e3a8a">

  <link rel="canonical" href="https://davidkozdra.com/">

  <title>David Kozdra</title>
  <link rel="stylesheet" href="styles/DE_styles.css" id="default" media="print" onload="this.media='all'">
  <noscript><link rel="stylesheet" href="styles/DE_styles.css"></noscript>

  <link rel="manifest" href="/manifest.json" />
  <link rel="stylesheet" id="modern" class="theme" href="styles/modern.css?v=1.15" media="print" onload="this.media='all'">
  <noscript><link rel="stylesheet" href="styles/modern.css?v=1.15"></noscript>
  <link rel="stylesheet" id="retro" class="theme" href="styles/retro.css?v=1.3" disabled="true" media="print" onload="this.media='all'">
  <noscript><link rel="stylesheet" href="styles/retro.css?v=1.3"></noscript>
  
  <link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="dns-prefetch" href="https://main.d3722xrzul5kke.amplifyapp.com">
  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link class="import" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" media="print" onload="this.media='all'">
  <noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"></noscript>
  <link rel="icon" type="image/x-icon" href="/images/brand/favicon.webp">
  <style>
    @font-face {
      font-display: swap;
    }
  </style>

  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Person",
    "name": "David Kozdra",
    "jobTitle": "Full-Stack Software Developer",
    "url": "https://davidkozdra.com",
    "sameAs": [
      "https://github.com/DavidKozdra",
      "https://www.linkedin.com/in/david-kozdra-5ab269186/",
      "https://magentaautumn.itch.io"
    ],
    "knowsAbout": ["MongoDB", "Express.js", "React.js", "Node.js", "MERN Stack", "JavaScript"],
    "email": "davidkozdra@gmail.com"
  }
  </script>

  <script src="Games.js?v=1.0" defer></script>

  <script src="index.js" defer></script>
  <style>
    /* Skip link for accessibility */
    .skip-link {
      position: absolute;
      top: -40px;
      left: 0;
      background: #000;
      color: #fff;
      padding: 8px;
      text-decoration: none;
      z-index: 100000;
    }
    
    .skip-link:focus {
      top: 0;
    }
    
    /* Focus visible styles for keyboard navigation */
    button:focus-visible,
    a:focus-visible,
    [role="button"]:focus-visible {
      outline: 3px solid #4a9eff;
      outline-offset: 2px;
    }
    
    .desktop-icon:focus-visible {
      outline: 3px solid #4a9eff;
      outline-offset: 2px;
      background: rgba(74, 158, 255, 0.2);
    }
    
    /* Visually hidden but accessible to screen readers */
    .visually-hidden {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border-width: 0;
    }
    
       .empty_window {
        display: none !important;
    }
    
    /* Performance optimization for loader */
    .loader-page {
      content-visibility: auto;
    }
    
    .loader-page[style*="display: block"] {
      min-height: 100vh;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      z-index: 9999;
    }
    
    /* Performance optimization for windows */
    .window {
      content-visibility: auto;
      contain: layout style paint;
    }
  
      #clock-items {
    display: flex;
    flex-direction: row;
    gap: 2px;
  }

  .menu-icon {
    width: 20px;               
    height: 20px;             
    margin-right: 10px;        
    vertical-align: middle;   
    object-fit: contain;  
    color: white !important;     
}

  /* Window button touch targets */
  .window-button {
    min-width: 48px;
    min-height: 48px;
    padding: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    border: none;
    background: transparent;
  }
  
  .window-button i {
    pointer-events: none;
  }
  
  /* Hide #clock-items on mobile devices */
  @media (max-width: 768px) {
    #clock-items {
      display: none;
    }
  }
  </style>
</head>

<body>
  <a href="#desktop" class="skip-link">Skip to main content</a>
  <h1 class="visually-hidden">David Kozdra - Full-Stack Software Developer Portfolio</h1>
  <div class="loader-page">
    <div class="loader-display">
      <picture>
        <source srcset="./images/brand/favicon.webp" type="image/webp">
        <img class="loader-icon" src="./images/brand/favicon.webp" alt="DK logo white and blue gradient background" width="100" height="100" fetchpriority="high">
      </picture>

      <p class="typewriter">
        Loading DK OS ...
      </p>

      <div class="loader-back">
        <div class="loader-icon-inner"></div>
      </div>
    </div>

  </div>
  <div id="de">
    <header class="task-bar" role="banner">
      <!-- Navigation Menu -->

        <nav class="navigation" aria-label="Main navigation">
          <div class="drop-down">
            <button style="padding: 0%;" aria-label="Open menu" aria-expanded="false" aria-haspopup="true"><picture>
                <source srcset="images/brand/favicon.webp" type="image/webp">
                <img src="images/brand/favicon.webp" alt="" id="task-bar-icon" width="32" height="32" role="presentation">
              </picture></button>
            <div class="drop-down-content">
              <!-- Tools Category -->
              <div class="category">
                  <div class="category-btn">Tools</div>
                  <div class="sub-category">
                      <button onclick="desktopIconRouter(event,'files')" aria-label="Open Files application">
                          <img src="./images/ui-icons/File_System_icon.webp" alt="" class="menu-icon" width="20" height="20" role="presentation"> Files
                      </button>
                      <button onclick="desktopIconRouter(event,'notes')" aria-label="Open Notes application">
                          <img src="./images/ui-icons/Notes.webp" alt="" class="menu-icon" width="20" height="20" role="presentation"> Notes
                      </button>
                      <button onclick="desktopIconRouter(event,'draw')" aria-label="Open Paint application">
                          <img src="./images/ui-icons/Pallet.webp" alt="" class="menu-icon" width="20" height="20" role="presentation"> Paint
                      </button>
                      <button onclick="desktopIconRouter(event,'calculator')" aria-label="Open Calculator application">
                          <img src="./images/ui-icons/Calc.webp" alt="" class="menu-icon" width="20" height="20" role="presentation"> Calculator
                      </button>
                      <button onclick="desktopIconRouter(event,'term')" aria-label="Open Terminal application">
                          <img src="./images/ui-icons/Term.webp" alt="" class="menu-icon" width="20" height="20" role="presentation"> Terminal
                      </button>
                  </div>
              </div>
          
              <!-- Games Category -->
              <div class="category">
                  <div class="category-btn">Games</div>
                  <div class="sub-category">
                      <button onclick="desktopIconRouter(event,'GOL')" aria-label="Open Game of Life application">
                          <img src="./images/ui-icons/GOL.webp" alt="" class="menu-icon" width="20" height="20" role="presentation"> Game of Life
                      </button>
                      <button onclick="desktopIconRouter(event,'dragon_game')" aria-label="Open DBZ Fighter game">
                          <img src="./images/ui-icons/dragon_fighter.webp" alt="" class="menu-icon" width="20" height="20" role="presentation"> DBZ Fighter
                      </button>
                   
                  </div>
              </div>
          
              <!-- Settings -->
              <button id="settingsButton" onclick="desktopIconRouter(event,'System')" aria-label="Open System settings">
                  System
              </button>
          
              <!-- Power Button -->
              <button onclick="refresh()" style="padding-bottom: 10%;" aria-label="Restart system">
                  <i class="fa fa-power-off" aria-hidden="true"></i> Power
              </button>
          </div>
          
        </div>
          


          <div >
            <button class="drop-down-menu-text" onclick="desktopIconRouter(event,'about')" aria-label="View work experience"> Experience  </button>
          </div>
          

          <div >
            <button class="drop-down-menu-text"  onclick="desktopIconRouter(event,'projects')" aria-label="View projects">Projects</button>

        </div>
          <div>
          <button  class="drop-down-menu-text" onclick="desktopIconRouter(event,'resume')" aria-label="View resume"> Resume</button>
  </div>
      </nav>

      <div class="status-bar">
        
        <div id="clock-items"><i class="fa-regular fa-clock"></i>  <div id="clock"></div></div>


        <div id="Contact">
          <a aria-label="Email David Kozdra" href="mailto:davidkozdra@gmail.com?subject=Let's%20Connect&body=I%20am%20connecting%20after%20viewing%20your%20website">
            <i class="fa fa-envelope fa-1x" aria-hidden="true"></i>
          </a>
          
          <a aria-label="Visit David Kozdra's GitHub profile" href="https://github.com/DavidKozdra" target="_blank" rel="noopener noreferrer"> <i
              class="fa-brands fa-github fa-1x" aria-hidden="true">
            </i></a>

          <a aria-label="Visit David Kozdra's LinkedIn profile" href="https://www.linkedin.com/in/david-kozdra-5ab269186/"
            target="_blank" rel="noopener noreferrer"> <i class="fa-brands fa-linkedin fa-1x" aria-hidden="true"> </i></a>

          <a aria-label="Visit David Kozdra's itch.io page" href="https://magentaautumn.itch.io"  target="_blank" rel="noopener noreferrer"> <i
              class="fa-brands fa-itch-io fa-1x" aria-hidden="true"></i></a>

              <div> <i class="fas fa-wifi"></i> </div>

        </div>

      </div>
    </header>

    <main id="desktop" ondrag="drawSelectionRect()">
      <div id="windows">

      </div>
      
      <div class="desktop-grid">
        
        <div class="desktop-icon" role="button" aria-label="Terminal application" onclick="selectIcon(event)" ondblclick="desktopIconRouter(event,'term')" onkeypress="if(event.key==='Enter')desktopIconRouter(event,'term')" tabindex="0">
          <picture>
            <source srcset="./images/ui-icons/Term.webp" type="image/webp">
            <img src="./images/ui-icons/Term.webp" alt="" width="64" height="64" role="presentation">
          </picture>
          <p class="icon-text">Terminal</p>
        </div>

        <div class="desktop-icon" role="button" aria-label="DBZ Fighter game" onclick="selectIcon(event)" ondblclick="desktopIconRouter(event,'dragon_game')" onkeypress="if(event.key==='Enter')desktopIconRouter(event,'dragon_game')" tabindex="0">
          <picture>
            <source srcset="./images/ui-icons/dragon_fighter.webp" type="image/webp">
            <img src="./images/ui-icons/dragon_fighter.webp" alt="" width="64" height="64" role="presentation">
          </picture>
          <p class="icon-text">dbz fighter</p>
        </div>

        <div class="desktop-icon" role="button" aria-label="Paint application" onclick="selectIcon(event)" ondblclick="desktopIconRouter(event,'draw')" onkeypress="if(event.key==='Enter')desktopIconRouter(event,'draw')" tabindex="0">
          <picture>
            <source srcset="./images/ui-icons/Pallet.webp" type="image/webp">
            <img src="./images/ui-icons/Pallet.webp" alt="" width="64" height="64" role="presentation">
          </picture>
          <p class="icon-text">Draw</p>
        </div>

        <div class="desktop-icon" role="button" aria-label="Game of Life application" onclick="selectIcon(event)" ondblclick="desktopIconRouter(event,'GOL')" onkeypress="if(event.key==='Enter')desktopIconRouter(event,'GOL')" tabindex="0"> 
          <picture>
            <source srcset="./images/ui-icons/GOL.webp" type="image/webp">
            <img src="./images/ui-icons/GOL.webp" alt="" width="64" height="64" role="presentation">
          </picture>
          <div class="icon-text">
            <p>Game Of Life</p>
          </div>
        </div>


<div class="desktop-icon" role="button" aria-label="Calculator application" onclick="selectIcon(event)" ondblclick="desktopIconRouter(event,'calculator')" onkeypress="if(event.key==='Enter')desktopIconRouter(event,'calculator')" tabindex="0">
          <picture>
            <source srcset="./images/ui-icons/Calc.webp" type="image/webp">
            <img src="./images/ui-icons/Calc.webp" alt="" width="64" height="64" role="presentation">
          </picture>
          <div class="icon-text">
            <p>Calculator</p>
          </div>
        </div>


        <div class="desktop-icon" role="button" aria-label="Notes application" onclick="selectIcon(event)" ondblclick="desktopIconRouter(event,'notes')" onkeypress="if(event.key==='Enter')desktopIconRouter(event,'notes')" tabindex="0"
          style="cursor: pointer;">
          <picture>
            <source srcset="./images/ui-icons/Notes.webp" type="image/webp">
            <img src="./images/ui-icons/Notes.webp" alt="" width="64" height="64" role="presentation">
          </picture>
          <div class="icon-text">
            <p>Notes</p>
          </div>
        </div>

        <div class="desktop-icon" role="button" aria-label="Files application" onclick="selectIcon(event)" ondblclick="desktopIconRouter(event,'files')" onkeypress="if(event.key==='Enter')desktopIconRouter(event,'files')" tabindex="0"
        style="cursor: pointer;">
        <img src="./images/ui-icons/File_System_icon.webp" alt="" width="64" height="64" role="presentation"></img>
        <div class="icon-text">
          <p>Files</p>
        </div>
      </div>
      </div>
    </main>

    <footer class="app-bar" role="contentinfo" aria-label="Application taskbar"> Tasks <div class="btn-group"> </div>
    <div class="app-bar-buffer">buffer</div>
    </footer>
  </div>


  <script>

    var fileSystem;

document.addEventListener('DOMContentLoaded', () => {
  
  let fileSystem = (localStorage.getItem("fileSystem") == null) ? [{ dir: "/", files: [{ name: "text.txt", content: "this is a test file you can read it directly or in the terminal", dir: false }, { name: "home", dir: true }] }, { dir: "home", files: [{ name: "text2.txt", content: ":) " }] }] : JSON.parse(localStorage.getItem("fileSystem"));
 
  window.addEventListener('message', (event) => {
    receiveMessage(event)
  }, false);

  desktopIconRouter(null, "System");

  desktopIconRouter(null, "empty");


  // render the file system if it has content
  // it should act as a notes icon with the file name as the name
  // and the content as the content
  
  for(let i = 0; i < fileSystem.length; i++){
    for(let j = 0; j < fileSystem[i].files.length; j++){
      if (fileSystem[i].files[j].dir) {
        continue;
      }
      let file = fileSystem[i].files[j];
      let icon = document.createElement("div");
      icon.classList.add("desktop-icon");
      icon.setAttribute("role", "button");
      icon.setAttribute("tabindex", "0");
      icon.setAttribute("aria-label", `Open ${file.name}`);
      icon.onclick = function(){
        selectIcon(event);
      };
      icon.ondblclick = function(){
        desktopIconRouter(event, "notes",  file.name , {content: file.content, parent: fileSystem[i].dir});
      };
      icon.onkeypress = function(e){
        if(e.key === 'Enter') {
          desktopIconRouter(e, "notes",  file.name , {content: file.content, parent: fileSystem[i].dir});
        }
      };
      let img = document.createElement("img");
      img.src = "./images/ui-icons/Notes.webp";
      img.setAttribute("alt", "");
      img.setAttribute("role", "presentation");
      img.setAttribute("width", "64");
      img.setAttribute("height", "64");
      let text = document.createElement("div");
      text.classList.add("icon-text");
      text.innerHTML = file.name;
      icon.appendChild(img);
      icon.appendChild(text);

      //init drag
      dragElement(icon, icon);


      
      //add to the grid
      //document.getElementsByClassName("desktop-grid")[0].appendChild(icon);
    }
  }
});

    let desktopIcons = document.getElementsByClassName("desktop-icon");


    let windows = document.getElementsByClassName("window");
    let winLen = 0;
    let activeWindowCount = 0;
    let loading = true;

    
    const adjustBoundaries = () => {
      const headerElement = document.getElementsByClassName('task-bar')[0];
      const appbarElement = document.getElementsByClassName('app-bar')[0];

      // Set your desired boundary left position
      const boundaryLeft = 10;

      // Get the height of the header and app bar
      const boundaryTop = headerElement ? headerElement.offsetHeight : 0;
      const maxBottom = appbarElement ? window.innerHeight - appbarElement.offsetHeight : window.innerHeight;

      return { boundaryTop, maxBottom, boundaryLeft };
    };

    const applyBoundaries = (array) => {
      const { boundaryTop, maxBottom, boundaryLeft } = adjustBoundaries();

      for (let i = 0; i < array.length; i++) {
        const rect = array[i].getBoundingClientRect();

        // check for collison with the appbar
        if (isColliding(array[i], document.getElementsByClassName('app-bar')[0])) {
          //array[i].style.top = maxBottom - array[i].offsetHeight + 'px';
          if (array[i].classList.contains("desktop-icon")) {
            array[i].style.top = maxBottom - window.innerHeight / 10 + 'px';
          } else {
            array[i].style.top = maxBottom - array[i].offsetHeight + 'px';
          }


        }

        if (rect.top < boundaryTop) {
          array[i].style.top = boundaryTop + 'px';
        }

        if (rect.left < boundaryLeft) {
          array[i].style.left = boundaryLeft + 'px';
        }

      }
    };

    let activeWindows = document.getElementsByClassName("window");

    let maxZindex = 1;
    async function update() {

      if (loading) {

        let stylesheetId = localStorage.getItem("defaultStyleSheet")
         window.parent.postMessage({ stylesheetId }, '*');
        document.getElementsByClassName("loader-page")[0].style.display = "block";
        document.getElementById("de").style.display = "none";
        await delay(500);
        document.getElementsByClassName("loader-page")[0].style.display = "none";
        document.getElementById("de").style.display = "block";
        loading = false;
      } else {

                //loop for all desktop icons - only check boundaries, not collisions in main loop
        for (let i = 0; i < desktopIcons.length; i++) {
          if (desktopIcons[i].offsetWidth > desktop.offsetWidth) {
            desktopIcons[i].style.width = desktop.offsetWidth + "px";
          }
          if (desktopIcons[i].offsetHeight > desktop.offsetHeight) {
            desktopIcons[i].style.height = desktop.offsetHeight + "px";
          }
        }

        activeWindows = document.getElementsByClassName("window");
        activeWindows = Array.from(activeWindows).filter(window => !window.classList.contains("minimized"));

        activeWindows.map(window => {


          // if the window is larger than the desktop area then set the dimentions to the desktop area
          if (window.offsetWidth > desktop.offsetWidth) {
            window.style.width = desktop.offsetWidth -5 + "px";
          }
          if (window.offsetHeight > desktop.offsetHeight) {
            window.style.height = desktop.offsetHeight -5  + "px";
          }

          //calculate the max z index
          if (window.style.zIndex > maxZindex) {
            maxZindex = window.style.zIndex;
          }

          window.childNodes[0].style.width = window.offsetWidth + "px";
        });

        if(activeWindowCount > 0){
          //get desktop and set the height to 92 dvh
          let desktop = document.getElementById("desktop");
          desktop.style.height = "92dvh";
        }else {
          //get desktop and set the height to 100 dvh
          let desktop = document.getElementById("desktop");
          desktop.style.height = "93.5dvh";
        }

        applyBoundaries(activeWindows);
        if (activeWindowCount != activeWindows.length) {
          ReRenderAppTaskbar();
          activeWindowCount = activeWindows.length;
        } else if (windows.length != winLen) {
          ReRenderAppTaskbar();
          winLen = windows.length;
        }
      }

      requestAnimationFrame(update);
    }

    function resizeWindowTItle(de_window) {
      let title = de_window.querySelector(".window-title");
      title.style.width = de_window.offsetWidth + "px";

    }

    function ReRenderAppTaskbar() {
      let taskbar = document.getElementsByClassName("app-bar");
      taskbar[0].innerHTML = "Tasks ";

      for (let i = 0; i < windows.length; i++) {
        if(windows[i].classList.contains("empty_window")){
          continue;
        }
        let taskbarButton = document.createElement("button");
        let taskbarButtonIcon = document.createElement("img");
        taskbarButtonIcon.alt = "";
        taskbarButtonIcon.setAttribute("role", "presentation");
        taskbarButtonIcon.classList.add("window-icon");
        taskbarButtonIcon.src = windows[i].childNodes[0].childNodes[0].src;
        taskbarButton.classList.add("app-bar-button");
        taskbarButton.setAttribute("aria-label", `Toggle ${windows[i].id} window`);
        if (windows[i].classList.contains("minimized")) {
          taskbarButton.classList.remove("app-bar-button-active");
        } else {
          taskbarButton.classList.add("app-bar-button-active");
        }
        taskbarButton.onclick = function () {
          if (windows[i].classList.contains("minimized")) {
            windows[i].classList.remove("minimized");
            setFocusedWindow(windows[i]);
          } else {
            windows[i].classList.add("minimized");
       
          }
        };
        taskbarButton.appendChild(taskbarButtonIcon);

        taskbarButton.innerHTML += windows[i].id;
        taskbar[0].appendChild(taskbarButton);
      }
    }

    function drawSelectionRect() {
      //take the mouse pos and draw a rect from the start to the current pos
      let rect = document.createElement("div");
      rect.classList.add("selection-rect");
      document.getElementById("desktop").appendChild(rect);
    }


        function CreateDesktopIconGrid() {
      const iconSize = 100; // Adjust this based on the desired icon size
      const margin = 20; // Adjust this based on the desired margin between icons
      const startX = 20; // Starting X position
      const startY = 20; // Starting Y position

      // Calculate the number of icons per row dynamically
      const iconsPerRow = Math.floor((window.innerWidth - startX - margin) / (iconSize + margin));
      let yPosition = startY;
      let xPosition = startX;
      let currentRow = 0;

      for (let i = 0; i < desktopIcons.length; i++) {
        // Move to next row if needed
        if (i > 0 && i % iconsPerRow === 0) {
          yPosition += iconSize + margin;
          xPosition = startX;
          currentRow++;
        }
        
        // Set the position of the icon based on the index
        desktopIcons[i].style.left = xPosition + "px";
        desktopIcons[i].style.top = yPosition + "px";
        
        // Move X position for next icon in row
        xPosition += iconSize + margin;
      }
    }

        function checkCollision(item1, item2) {
      const rect1 = item1.getBoundingClientRect();
      const rect2 = item2.getBoundingClientRect();

      return (
        rect1.left < rect2.right &&
        rect1.right > rect2.left &&
        rect1.top < rect2.bottom &&
        rect1.bottom > rect2.top
      );
    }

    function resolveIconCollisions(draggedIcon) {
      const icons = Array.from(desktopIcons);
      const COLLISION_OFFSET = 10;
      
      for (let icon of icons) {
        if (icon === draggedIcon) continue;
        
        if (checkCollision(draggedIcon, icon)) {
          const rect1 = draggedIcon.getBoundingClientRect();
          const rect2 = icon.getBoundingClientRect();
          
          // Calculate overlap
          const overlapX = Math.min(rect1.right - rect2.left, rect2.right - rect1.left);
          const overlapY = Math.min(rect1.bottom - rect2.top, rect2.bottom - rect1.top);
          
          // Move in the direction with less overlap
          if (overlapX < overlapY) {
            // Move horizontally
            if (rect1.left < rect2.left) {
              draggedIcon.style.left = (parseFloat(draggedIcon.style.left) - overlapX - COLLISION_OFFSET) + 'px';
            } else {
              draggedIcon.style.left = (parseFloat(draggedIcon.style.left) + overlapX + COLLISION_OFFSET) + 'px';
            }
          } else {
            // Move vertically
            if (rect1.top < rect2.top) {
              draggedIcon.style.top = (parseFloat(draggedIcon.style.top) - overlapY - COLLISION_OFFSET) + 'px';
            } else {
              draggedIcon.style.top = (parseFloat(draggedIcon.style.top) + overlapY + COLLISION_OFFSET) + 'px';
            }
          }
        }
      }
    }


    function isColliding(item1, item2) {
      const rect1 = item1.getBoundingClientRect();
      const rect2 = item2.getBoundingClientRect();

      if (
        rect1.left < rect2.right &&
        rect1.right > rect2.left &&
        rect1.top < rect2.bottom &&
        rect1.bottom > rect2.top
      ) {
        return true;
      } else {
        return false;
      }
    }


    CreateDesktopIconGrid();


    // has to do it this way no event
    //desktopIconRouter(document.getElementById("settingsButton").event, "System");


    function DisplayDate() {
      var date = new Date();
      var hours = date.getHours();
      var minutes = date.getMinutes();
      var seconds = date.getSeconds();
      var ampm = "AM";
      if (hours > 12) {
        hours = hours - 12;
        ampm = "PM";
      }
      if (hours == 0) {
        hours = 12;
      }
      if (minutes < 10) {
        minutes = "0" + minutes;
      }
      if (seconds < 10) {
        seconds = "0" + seconds;
      }
      var time = hours + ":" + minutes + ":" + seconds + " " + ampm;
      document.getElementById("clock").innerHTML = time;
    }

    setInterval(DisplayDate, 500);


    function closeWindow(e, name) {
      // close the parent window from the event target
      let closest_window = e.target.closest(".window");
      closest_window.remove();
    }

    function minimizeWindow(e, name) {
      let closest_window = e.target.closest(".window ");
      closest_window.classList.toggle("minimized");
    }

    function maximizeWindow(e, name) {
      let currentWindow = e.target.closest(".window");

      if (currentWindow !== null) {
        currentWindow.classList.toggle("larger");

        // Check if there's an existing child before removing it
        if (e.target.childNodes[0] !== undefined) {
          e.target.childNodes[0].remove();
        }

        let windowbuttons = currentWindow.querySelector(".window-buttons");
        windowbuttons.childNodes[1].innerHTML = "";
        // Create a new icon element
        let icon = document.createElement('i');
        icon.classList.add('fas');
        icon.setAttribute("aria-label", "Minimize window button");
        // Determine the icon class based on the "larger" class
        if (currentWindow.classList.contains("larger")) {
          icon.classList.add('fa-compress');
        } else {
          icon.classList.add('fa-expand');
        }


        // Append the icon to the target element
        windowbuttons.childNodes[1].appendChild(icon);


        resizeWindowTItle(currentWindow);
      }
    }




    //function to check if the window button has both fa-expand and fa-compress
    function checkWindowButton(e) {
      if (e.target.classList.contains("fa-expand") && e.target.classList.contains("fa-compress")) {
        return true;
      } else {
        return false;
      }
    }


        function dragElement(title, elmnt) {
      var pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;
      var isDragging = false;
      if (title == null) {
        return;
      }

      // If present, the header is where you move the DIV from:
      title.onmousedown = dragMouseDown;

      function dragMouseDown(e) {
        e = e || window.event;
        e.preventDefault();
        isDragging = true;

        // Get the mouse cursor position at startup:
        pos3 = e.clientX;
        pos4 = e.clientY;
        document.onmouseup = handleDragEnd;
        document.onpointerup = handleDragEnd;
        document.ontouchend = handleDragEnd;
        // Call a function whenever the cursor moves:
        document.onpointermove = elementDrag;
        document.onmousemove = elementDrag;
      }

      function elementDrag(e) {
        if (!isDragging) return;
        e = e || window.event;
        e.preventDefault();
        // Calculate the new cursor position:
        pos1 = pos3 - e.clientX;
        pos2 = pos4 - e.clientY;
        pos3 = e.clientX;
        pos4 = e.clientY;

        // Get desktop boundaries
        const desktop = document.getElementById('desktop');
        const taskBar = document.querySelector('.task-bar');
        const appBar = document.querySelector('.app-bar');
        
        const minTop = taskBar ? taskBar.offsetHeight + 10 : 10;
        const maxTop = appBar ? window.innerHeight - appBar.offsetHeight - elmnt.offsetHeight - 10 : window.innerHeight - elmnt.offsetHeight - 10;
        const minLeft = 10;
        const maxLeft = window.innerWidth - elmnt.offsetWidth - 10;

        // Calculate new position with boundaries
        let newTop = elmnt.offsetTop - pos2;
        let newLeft = elmnt.offsetLeft - pos1;
        
        // Clamp values to boundaries
        newTop = Math.max(minTop, Math.min(newTop, maxTop));
        newLeft = Math.max(minLeft, Math.min(newLeft, maxLeft));

        // Set the element's new position:
        elmnt.style.top = newTop + "px";
        elmnt.style.left = newLeft + "px";
      }

      function handleDragEnd() {
        isDragging = false;
        closeDragElement();
        
        // Check for icon collisions only when drag ends
        if (elmnt.classList.contains('desktop-icon')) {
          resolveIconCollisions(elmnt);
        }
      }
    }
    function closeDragElement() {
      // Stop moving when the mouse button is released:
      document.onmouseup = null;
      document.onpointerup = null;
      document.onmousemove = null;
      document.ontouchend = null;

      // this one fixes the weird bug where the mouse is still in the window and it moves
      document.onpointermove = null;
    }
    function setCursor() {
      //conditionally set the cursor to wait globally
      document.body.style.cursor = "wait";
    }

    function deselectAllIcons() {
      let desktopIcons = document.getElementsByClassName("desktop-icon");
      for (let i = 0; i < desktopIcons.length; i++) {
        desktopIcons[i].classList.remove("active");
      }
    }

    function selectIcon(e) {
      if (!e.target.classList.contains("icon-text")) {
        e.target.classList.toggle("active");
      }


      e.target.classList.toggle("active");
    }
    function delay(ms) {
      return new Promise(resolve => setTimeout(resolve, ms));
    }

    async function desktopIconRouter(e, newWindowHeaderTitle, newTitle=undefined,data=undefined) {
      // Set the cursor to the waiting state
      if(e != null){
        setCursor(e);
      }

      // Wait for the specified delay
      await delay((Math.random() * 400) + 150);

      // Now the delay is complete, proceed to open the window
      switch (newWindowHeaderTitle) {
        case "test":
          createWindow("Test", "This is a test window", "./images/projects/blocks.webp", false);
          break;
          case "empty": 
          createWindow("empty", null, "./images/ui-icons/Term.webp", 800);
          break;
        case "term": 
          let term = document.createElement("iframe");
          term.name = "terminal";
          term.title = "terminal";
          term.style.marginTop = "50px";
          term.src = "./CMD.html";
          term.loading = "lazy";
          term.style.height = "100%";
          term.style.width = "100%";
          createWindow("Terminal", term, "./images/ui-icons/Term.webp", 800);
          break;
        case "resume":
          let resume = document.createElement("iframe");
          resume.name = "resume";
          resume.title = "resume";
          resume.src = "./resume.html";
          resume.loading = "lazy";
          resume.style.height = "90%";
          resume.style.marginTop = "50px";
          resume.style.width = "100%";
          resume.frameborder = "0";

          createWindow("Resume", resume, "./images/projects/Resume.webp", 800);


          break;

        case "System":
          let intro = document.createElement("iframe");
          intro.name = "Intro Panel";
          intro.title = "Intro Panel";
          intro.src = "./intro.html";
          intro.style.height = "100%";
          intro.style.width = "100%";
          createWindow("Welcome", intro, "./images/brand/favicon.webp", 1200, true);
          break;


        case "calculator":
          let calculator = document.createElement("iframe");
          calculator.name = "calculator";
          calculator.title = "calculator";
          calculator.src = "./calculator.html";
          calculator.loading = "lazy";
          calculator.style.height = "100%";
          calculator.style.width = "100%";
          createWindow("Calculator", calculator, "./images/ui-icons/Calc.webp", 400, false);
          break;
        case "dragon_game":
          let game = document.createElement("iframe");
          game.name = "dragon_game";
          game.title = "dragon_game";
          game.src = "https://main.d3722xrzul5kke.amplifyapp.com/";
          game.loading = "lazy";
          game.style.height = "100%";
          game.style.width = "100%";
          game.style.overflowY = "hidden";
          createWindow("dragon fighter conquest", game, "./images/ui-icons/dragon_fighter.webp", 800, false);
          break;
 
                    case "notes":
          let notes = document.createElement("div");

        let fileSystem = localStorage.getItem("fileSystem") == null
            ? [
                {
                    dir: "/",
                    files: [
                        {
                            name: "text.txt",
                            content: "this is a test file you can read it directly or in the terminal",
                            dir: false
                        },
                        {
                            name: "home",
                            dir: true
                        }
                    ]
                },
                {
                    dir: "/home",
                    files: [
                        {
                            name: "text2.txt",
                            content: ":) ",
                            dir: false
                        }
                    ]
                }
            ]
            : JSON.parse(localStorage.getItem("fileSystem"));



          notes.classList.add("notes");
          notes.name = "note pad";
          notes.title = "note pad";

          let label = document.createElement("label");
          label.className = "visually-hidden";
          label.setAttribute("for", "notes-textarea");
          label.textContent = "Note content";

          let textArea = document.createElement("textarea");
          textArea.classList.add("notes-textarea");
          textArea.rows = "25";
          textArea.cols = "45";
          textArea.placeholder = "Enter your notes here";
          textArea.setAttribute("aria-label", "Note content");
          textArea.id = "notes-textarea";

          let isNew = false;
          let currentFileDir = null;
          let currentFileName = null;
          
          if (data && data.content !== undefined) {

              textArea.value = data.content;
              currentFileDir = data.dir;
              currentFileName = data.name;
          } else {

              isNew = true;
              currentFileDir = "/home";
              currentFileName = "note_" + Date.now() + ".txt";
          }

          // Local storage for notes: get and set on change of value
          textArea.oninput = function () {

              
              if (isNew) {
                  // Creating a new file
                  let targetDir = fileSystem.find(dir => dir.dir === currentFileDir);
                  
                  if (targetDir) {
                      targetDir.files.push({
                          name: currentFileName,
                          content: textArea.value,
                          dir: false
                      });
                  } else {
                      // Create directory if it doesn't exist
                      fileSystem.push({
                          dir: currentFileDir,
                          files: [{
                              name: currentFileName,
                              content: textArea.value,
                              dir: false
                          }]
                      });
                  }
                  isNew = false;

              } else {
                  // Updating existing file
                  let targetDir = fileSystem.find(dir => dir.dir === currentFileDir);
                  
                  if (targetDir) {
                      let file = targetDir.files.find(f => f.name === currentFileName && !f.dir);
                      if (file) {
                          file.content = textArea.value;

                      }
                  }
              }
              
              // Save to localStorage
              localStorage.setItem("fileSystem", JSON.stringify(fileSystem));
          };

          notes.appendChild(label);
          notes.appendChild(textArea);

          createWindow(newTitle ? newTitle : "Notes", notes, "./images/ui-icons/Notes.webp", 500);
    break;


        case "about":
          let about = document.createElement("iframe");
          about.name = "about David Kozdra";
          about.title = "about David Kozdra";
          about.src = "./about.html";
          about.loading = "lazy";
          about.style.height = "100%";
          about.style.width = "100%";
          createWindow("Work", about, "./images/profile/ME.webp", 1800,true,true);
          break;
        case "projects":
          let Projects = document.createElement("iframe");
          Projects.name = "about David Kozdra";
          Projects.title = "about David Kozdra";
          Projects.src = "./projects.html";
          Projects.loading = "lazy";
          Projects.style.height = "100%";
          Projects.style.width = "100%";
          createWindow("projects", Projects, "./images/profile/ME.webp", 1800,true,true);
          break;
        case "files":
          let files = document.createElement("iframe");
          files.name = "files";
          files.title = "files";
          files.src = "./file_browser.html";
          files.loading = "lazy";
          files.style.height = "100%";
          files.style.width = "100%";
          createWindow("files", files, "./images/ui-icons/File_System_icon.webp", 800);
          break;

        case "old":
          let iframe = document.createElement("iframe");
          iframe.name = "old website";
          iframe.title = "old website";
          iframe.src = "./old_site.html";
          iframe.loading = "lazy";
          iframe.style.height = "700px";
          iframe.style.width = "100%";
          createWindow("Old Website", iframe, "./images/brand/favicon.webp", 800);
          break;


        case "error":
          createWindow("Error", "This is a test window", "./images/ui-icons/Pallet.webp", 200);

        case "draw":
          let draw = document.createElement("iframe");
          draw.name = "drawing";
          draw.title = "drawing";
          draw.src = "./drawing.html";
          draw.loading = "lazy";
          draw.style.height = "100%";
          draw.style.width = "100%";
          draw.style.marginTop = "50px";
          createWindow("Drawing", draw, "./images/ui-icons/Pallet.webp", 1000, false);
          break;

        case "GOL":
          let GOLcontainer = document.createElement("iframe");
          GOLcontainer.name = "Game of Life";
          GOLcontainer.title = "Game of Life";
          GOLcontainer.src = "./GOL.html";
          GOLcontainer.loading = "lazy";
          GOLcontainer.style.height = "100%";
          GOLcontainer.style.width = "100%";

          createWindow("Game of Life", GOLcontainer, "./images/ui-icons/GOL.webp", 500, false);
          currentSlide = -1;
          init()
          break;
        default:
          console.error("Window not found");
          break;
      }

      // Reset the cursor to the default state
      document.body.style.cursor = "default";
      if(e){
        e.target.style.cursor = "default";
      }


    }

    function setCursor(e) {
      if (!e && !e.target ) return
        if(e.target.style){
        // Your cursor-setting logic here
        document.body.style.cursor = "wait";
        // set important cursor styles

        e.target.style.cursor = "wait";
      }
    }
    function createWindow(title, content, iconSrc, width, canResize = true, max_size=false) {


      const id = title.toLowerCase().replace(/\s+/g, '-'); // Generate id based on the title
      const newWindow = document.createElement("div");
      
      newWindow.classList.add("window");
      if(max_size){
        
      newWindow.classList.add("Max_window");
      }
      newWindow.id = id;


      const headerImage = createWindowHeaderImage(iconSrc);
      const header = createWindowHeader(title, id);
      const buttons = createWindowButtons(id, canResize);

      header.appendChild(headerImage);
      header.innerHTML += title;
      header.appendChild(buttons);
      newWindow.style.width = width + "px";
      newWindow.marginTop = "50px";
      newWindow.appendChild(header);

      // Check if the content is a node 
      if (!(content instanceof Node)) {
        const windowContent = createWindowContent(content);
        newWindow.appendChild(windowContent);
      } else {
        newWindow.appendChild(content);
      }

      newWindow.onmousedown = function () {
        setFocusedWindow(newWindow);
      };

      newWindow.onmouseleave = function () {
        //!! set the drag element to null
        closeDragElement();
        document.onpointermove = null;
      };
      newWindow.onmouseup = function () {
        closeDragElement();
        
        //!! set the drag element to null should work but doesnt
        //document.onpointermove = null;
      };


      if (title == "empty") {
        newWindow.classList.add("empty_window");
      }
      newWindow.style.display = "block";
      document.getElementById("windows").appendChild(newWindow);

      // Set the window position
      //newWindow.style.top = y + "px";
      //newWindow.style.left = x + "px";


      resizeWindowTItle(newWindow);
      // Initialize drag behavior
      dragElement(header, newWindow);
      setFocusedWindow(newWindow)


      return newWindow;
    }

    function setFocusedWindow(newWindow){
      if (newWindow.style.zIndex !== maxZindex) {
          maxZindex += 1;
          newWindow.style.zIndex = maxZindex;
        } else {
          // If the z-index is already the maximum, do nothing
          console.error("Already at maximum z-index:", newWindow.style.zIndex);
        }
    }

    function createWindowHeaderImage(src) {
      const headerImage = document.createElement("img");
      headerImage.classList.add("window-icon");
      headerImage.src = src;
      return headerImage;
    }

    function createWindowHeader(title, id) {
      const header = document.createElement("div");
      header.classList.add("window-title");
      return header;
    }

    function createWindowButtons(id, canResize = true) {
      const buttons = document.createElement("div");
      buttons.classList.add("window-buttons");
      let minIcon = document.createElement("i");
      minIcon.classList.add("fas");
      minIcon.classList.add("fa-chevron-down");

      const buttonMin = createWindowButton(minIcon, function () {
        minimizeWindow(event, id);
      }, "Minimize window");
      let buttonMax;
      if (canResize) {
        let maxIcon = document.createElement("i");
        maxIcon.classList.add("fas");
        maxIcon.classList.add("fa-expand");

        buttonMax = createWindowButton(maxIcon, function () {
          maximizeWindow(event, id);
        }, "Maximize window");
      }

      let closeIcon = document.createElement("i");
      closeIcon.classList.add("fas");
      closeIcon.classList.add("fa-times");

      const buttonClose = createWindowButton(closeIcon, function () {
        closeWindow(event, id);
      }, "Close window");


      buttonMin.style.color = "black";
      buttonClose.style.color = "black";

      buttons.appendChild(buttonMin);
      if (canResize == true) {
        buttonMax.style.color = "black";
        buttons.appendChild(buttonMax);
      }
      buttons.appendChild(buttonClose);

      return buttons;
    }

    function createWindowButton(icon, clickHandler, ariaLabel) {
      const button = document.createElement("button");
      button.classList.add("window-button");
      button.setAttribute("aria-label", ariaLabel);
      button.type = "button";

      icon.setAttribute("aria-hidden", "true");
      button.appendChild(icon);
      button.addEventListener('click', clickHandler);
      return button;
    }

    function createWindowContent(content) {
      const contentElement = document.createElement("div");
      contentElement.classList.add("window-content");

      const contentText = document.createElement("p");
      contentText.innerHTML = content;

      // Modify this part to add your specific content, e.g., iframe
      contentElement.appendChild(contentText);
      return contentElement;
    }

    // Initialize drag for desktop icons
    for (let i = 0; i < desktopIcons.length; i++) {
      dragElement(desktopIcons[i], desktopIcons[i]);
      desktopIcons[i].onmouseup = function () {
        
        document.onpointermove = null;
        closeDragElement();
      };
      
    }

    function moveElement(event, element) {
      if (element == null) {
        return;
      }

      const draggedElement = element;

      //element.style.cursor = "grabbing";

      // Check if the mouse is pressed
      if (event.buttons !== 1) return;

      // Calculate the new position of the dragged element
      const newX = event.clientX - draggedElement.offsetWidth / 2;
      const newY = event.clientY - draggedElement.offsetHeight / 2;

      // Set the new position
      draggedElement.style.left = newX + 'px';
      draggedElement.style.top = newY + 'px';
    }

    requestAnimationFrame(update);


    function refresh() {
      location.reload();
    }

    window.addEventListener('resize', function () {
      for (let i = 0; i < activeWindows.length; i++) {
        resizeWindowTItle(activeWindows[i]);
        applyBoundaries(activeWindows);

      }
      CreateDesktopIconGrid();
    });

        // Function to handle messages from the intro iframe
    function receiveMessage(event) {
      if(!event || event?.data?.message?.text == "Initializing..."){
        return;
      }



      // Handle file opening from file browser
      if (event.data.file && event.data.action === 'openFile'){
        let file = event.data.file;

        let data = {
          content: file.content,
          dir: event.data.dir,
          name: file.name
        };
        // Pass null as first parameter since we don't have an actual event
        desktopIconRouter(null, 'notes', file.name, data);
        return;
      }

      // Handle legacy file opening (keeping for backwards compatibility)
      if (event.data.file){
        let file = event.data.file;

        let data = {
          content: file.content,
          dir: event.data.dir,
          name: file.name
        };
        desktopIconRouter(event, 'notes', event.data.file.name, data);
        return;
      }

      // Handle theme changes
      if (event.data && event.data.stylesheetId) {
        // Disable all parent stylesheets
        const parentStylesheets = document.getElementsByClassName('theme');
        Array.from(parentStylesheets).forEach(sheet => {

          sheet.disabled = true;
        });
        localStorage.setItem('defaultStyleSheet', event.data.stylesheetId);
        let target_theme = document.getElementById(event.data.stylesheetId);

        // Enable the selected stylesheet in the parent document
        target_theme.disabled = false;
      }
    }

  </script>


</body>

</html>