<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>

    <style>
        #browser-container {
            margin-top: 10%;
            display: grid;
            grid-template-columns: 1fr 3fr;
        }

        #file-navigation {
            display: flex;
            flex-direction: column;
        }

        #browser {

        }

        #top {

        }

        #arrows {
            display: flex;
            flex-direction: row;
            justify-content: space-between;
        }

        #search {

        }

        .folder, .file {
            cursor: pointer;
            padding: 5px;
            border-bottom: 1px solid #ddd;
            flex-direction: column;
            display: flex;
        }

   

        .folder:hover, .file:hover {
            background-color: #f0f0f0;
        }
    </style>
</head>
<body>

    <div id="browser-container">
        <div id="file-navigation">
            <div id="arrows">
                <button id="back-btn" disabled>Back</button>
                <button id="up-btn">Up</button>
            </div>
            <div id="dir-content">
                NAV
            </div>
        </div>

        <div id="browser">
            <div id="top">
                <div id="search">
                    <input type="text" id="search-input" placeholder="Search files...">
                </div>
            </div>
            <div id="file-viewer">
                CONTENT
            </div>
        </div>
    </div>

    <script>
        // Get file system data from localStorage (as JSON)
        let fileSystem = JSON.parse(localStorage.getItem("fileSystem")) || [];

        // Pointer to current directory
        let currentDir = "/";
        let history = [];  // To track directory history for back button

        // Function to render the current directory content
        function renderCurrentDir() {
            // Find the current directory object
            let dirObject = null
            console.log(fileSystem.length)
            for (let i = 0; i < fileSystem.length; i++) {
                console.log(fileSystem[i])
                if (fileSystem[i].dir == currentDir) {
                    //this should be parent
                    dirObject = fileSystem[i];
                    break
                }
            }
            let dirContent = document.getElementById('dir-content');
            dirContent.innerHTML = ''; // Clear current content

            if (!dirObject) {
                console.log("file system error")
                return
            }; // Handle case if directory not found

            console.log(dirObject.files, "??")
            dirObject.files.forEach(file => {
               console.log("???", file)
                let fileElement = document.createElement('div');

                let fileElementImage = document.createElement('img');
                fileElement.className = file.dir ? 'folder' : 'file';
                fileElement.textContent = file.name;

                if (file.dir){
                    fileElementImage.src="images/File_System_icon.png"
                }else {

                    fileElementImage.src="images/Notes.png"
                }
                fileElement.appendChild(fileElementImage)
                fileElement.addEventListener('click', () => {
                    if (file.dir) {
                        // If it's a folder, navigate into it
                        history.push(currentDir);
                        currentDir = file.name;
                        renderCurrentDir();
                    } else {
                        // Display file content if it's a file
                        displayFileContent(file);
                    }
                });

                dirContent.appendChild(fileElement);
            });

            // Enable or disable the "Back" button based on history
            document.getElementById('back-btn').disabled = history.length === 0;
       
        }

        // Function to display file content in the browser area
        function displayFileContent(file) {
            let fileViewer = document.getElementById('file-viewer');
            fileViewer.textContent = file.content || 'No content available.';
        }

        // Navigate back in directory history
        document.getElementById('back-btn').addEventListener('click', () => {
            if (history.length > 0) {
                currentDir = history.pop();
                renderCurrentDir();
            }
        });

        // Navigate up in the directory hierarchy
        document.getElementById('up-btn').addEventListener('click', () => {
            if (currentDir !== "/") {
                let parentDir = currentDir.substring(0, currentDir.lastIndexOf('/')) || "/";
                currentDir = parentDir;
                renderCurrentDir();
            }
        });
        document.getElementById('up-btn').disabled = currentDir=="/"

        // Initial render
        renderCurrentDir();
    </script>

</body>
</html>
